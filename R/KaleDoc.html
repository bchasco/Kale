<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brandon Chasco">

<title>Kale : Lewis River Carcassess</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="KaleDoc_files/libs/clipboard/clipboard.min.js"></script>
<script src="KaleDoc_files/libs/quarto-html/quarto.js"></script>
<script src="KaleDoc_files/libs/quarto-html/popper.min.js"></script>
<script src="KaleDoc_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="KaleDoc_files/libs/quarto-html/anchor.min.js"></script>
<link href="KaleDoc_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="KaleDoc_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="KaleDoc_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="KaleDoc_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="KaleDoc_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="KaleDoc_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="KaleDoc_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Kale : Lewis River Carcassess</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brandon Chasco </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<section id="births" class="level3">
<h3 class="anchored" data-anchor-id="births">Births</h3>
<p>The number of carcasses births in each time period <span class="math inline">\(t\)</span> is equal to,</p>
<p><span class="math display">\[
\mathrm{b}_t =exp(\mu_B \times\varepsilon^\mathrm{b}_t)
\]</span></p>
<p>where <span class="math inline">\(\mathrm{b}_t\)</span> is the number of carcasses arriving during time period <span class="math inline">\(t\)</span> , <span class="math inline">\(\mu_B\)</span> is the average number of carcasses arriving across all time periods, and <span class="math inline">\(\varepsilon^B_t\)</span> is the random variability in the carcasses arrival process.</p>
<p>In the Lewis River, carcasses can be <em>born</em> into any one of five locations (i.e., states). The distribution of births into those locations is governed by a vector of probabilities that sum to one, <span class="math inline">\(\boldsymbol{\mathrm{\pi}}\)</span></p>
<p><span class="math display">\[
\pi_s = \frac{exp(\beta_s)}{\sum_s exp(\beta_s)}, \forall s&lt;6
\]</span></p>
<p>where the parameter <span class="math inline">\(\beta_{s=5}\)</span> is fixed to zero, and <span class="math inline">\(\pi_6\)</span> is equal to zero. The number of carcass <em>births</em> in state/location <span class="math inline">\(s\)</span> during time period <span class="math inline">\(t\)</span> is equal to</p>
<p><span class="math display">\[
B_{t,s} = \mathrm{b}_t\times\pi_s
\]</span></p>
</section>
<section id="carcass-abundance" class="level3">
<h3 class="anchored" data-anchor-id="carcass-abundance">Carcass abundance</h3>
<p>The total number of carcasses in location <em>s</em> at time <em>t</em> is</p>
<p><span class="math display">\[
\mathbf{\mathrm{N}}_{t,\bullet} = \boldsymbol{\Phi}_{\Delta t}^\mathrm{T}\bigr(\mathbf{\mathrm{N}}_{t-\Delta t,\bullet}  + \mathbf{\mathrm{B}}_{t,\bullet}\bigr)
\]</span></p>
<p>where <span class="math inline">\(\mathbf{\mathrm{N}}_{t,\bullet}\)</span> is the vector of total carcasses at time <span class="math inline">\(t\)</span> for all <span class="math inline">\(s\)</span> states, <span class="math inline">\(\boldsymbol{\Phi}_{\Delta t}^\mathrm{T}\)</span> is the transpose of state transition probability matrix, and <span class="math inline">\(\Delta t\)</span> is the time between the current time-step and the previous time step. The transposition, <span class="math inline">\(\mathrm{T}\)</span> of the state transition matrix is necessary because the population model assumes the initial states are represented by rows, whereas the mark-recapture process assumes that initial states are represent by columns. The population in the previous time-step is <span class="math inline">\(\mathbf{N}_{t-\Delta t,\bullet}\)</span>. The vector of of births time-step <em>t</em> ( <span class="math inline">\(\mathrm{B}_{t,\bullet}\)</span> ) is multiplied by the state transition probability matrix, because some of the births would be expected to have transitioned to the <em>death</em> state before they were surveyed at time <em>t.</em> Failure to include would result in a model that assume the only non-detect births were do to detection efficiency and not the fact that some carcasses are simply will never be recaptured.</p>
<p>The initial condition for the abundance process is simply the <em>births,</em></p>
<p><span class="math display">\[
\mathbf{\mathrm{N}}_{1,\bullet} = \boldsymbol{\Phi}_{\Delta t}^\mathrm{T} \mathrm{B}_{1,\Delta t,\bullet}
\]</span></p>
<p>where, <span class="math inline">\(\Delta t\)</span> is the would be equal to the time period between the initial survey and the when the first carcass is likely to have show up on the spawning grounds.</p>
</section>
<section id="state-transition-probability-matrix-phi_delta-t" class="level3">
<h3 class="anchored" data-anchor-id="state-transition-probability-matrix-phi_delta-t">State transition <em>probability</em> matrix, <span class="math inline">\(\Phi_{\Delta t}\)</span></h3>
<p>The state transition probability matrix describes the probability of a carcass remaining in its tagging location, transitioning and being recapture to another location, or never being recaptured again. The probability matrix <span class="math inline">\(\Phi_{\Delta t}\)</span> is derived from the transition <em>rate</em> matrix <span class="math inline">\(\mathrm{Q}\)</span> and the difference in time <span class="math inline">\(\Delta t\)</span> between surveys.</p>
<p>If there are <span class="math inline">\(ns\)</span> locations, then the dimension of the transition matrix is <span class="math inline">\(ns \times ns\)</span>.</p>
<p><span class="math display">\[
\mathrm{Q} =
\begin{bmatrix}
-\sum_{j\neq1}q_{1j} &amp; q_{12} &amp; \cdots &amp; q_{1n} \\
q_{2j} &amp; -\sum_{j\neq2}q_{2j} &amp; \cdots &amp; q_{2n} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; \cdots &amp; 0
\end{bmatrix}
\]</span></p>
<p>The off-diagonal values describe the <em>instantaneous</em> <em>rate</em> (i.e., ratio per unit time) that individual transitions from one state to another. For instance, <span class="math inline">\(q_{12}\)</span> describes the transition rate from state 1 to state 2 per unit time, <span class="math inline">\(q_{21}\)</span> describes the transition rate from state 2 to state 1. Because the transition rate is a Markov process, the rows must sum to 0; thus, the diagonal elements (i.e., the rate at which an individual remains in a state) is <span class="math inline">\(-\sum_{j\forall j\neq i}q_{i,j}\)</span> . The last row of the matrix is called the absorbing state – the probability of transitioning from <em>death</em> to one of the other states – which is zero. The parameters of the transition rate matrix <span class="math inline">\(q_{\bullet,\bullet}\)</span> are the parameters of the model to be estimated. These parameters do not need to be fixed. They can be genrelized as a function of the intrinsic attributes of the carcass (e.g., size or sex) or extrinsic attributes of the environment (e.g., distance between locations or flow during the survey period), where the coefficients of the transition are estimated.</p>
<p>The parameters of state transition probability matrix are derived from the exponent of the transition rate matrix <span class="math inline">\(\mathrm{Q}\)</span>.</p>
<p><span class="math display">\[
\Phi_{\Delta t} = e^{\mathrm{Q}\times \Delta t} =  \begin{bmatrix} \phi_{1j} &amp; \phi_{12} &amp; \cdots &amp; \phi_{1n} \\ \phi_{2j} &amp; \phi_{2j} &amp; \cdots &amp; \phi_{2n} \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 0 &amp; 0 &amp; \cdots &amp; 1 \end{bmatrix}
\]</span></p>
<p>where, <span class="math inline">\(e\)</span> is the matrix exponent. Exponentiation of the rate matrix results in a transition matrix where the sum of the rows are now one rather than zero. Most statistical software packages have a matrix exponent function (e.g., Matrix::expm is the matrix exponential function R).</p>
<p>Lastly, the transition probability matrix fully accounts for the entire carcass sampling design. In particular, the recovery of a carcass results in a change of state, because the tail of the carcass is removed and it is considered to have transitioned to the <em>dead</em>. The transition time between a carcass being <em>alive</em> and <em>dead</em> is nearly instantaneous <span class="math inline">\(\Delta t \rightarrow 0\)</span>, which means the transition probability matrix approaches the identity matrix. The importance of this is explained in the mark-recapture likelihood.</p>
<p><span class="math display">\[ lim_{\Delta t \rightarrow 0}\Phi_{\Delta t} = e^{\mathrm{Q}\times \Delta t} =  \begin{bmatrix} 1 &amp; 0 &amp; \cdots &amp; 0 \\ 0 &amp; 1 &amp; \cdots &amp; 0 \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 0 &amp; 0 &amp; \cdots &amp; 1 \end{bmatrix} = \mathrm{I}_{ns}\]</span></p>
</section>
<section id="carcass-sampling-rate" class="level3">
<h3 class="anchored" data-anchor-id="carcass-sampling-rate">Carcass sampling rate</h3>
<p>The carcasses sampling rate is a function of the observed carcasses at time-step <em>t</em> in location <em>s</em>, <span class="math inline">\(C_{t,s}\)</span>, and the predicted total number of carcasses at time-step <em>t</em> in location <em>s,</em> <span class="math inline">\(\mathrm{N}_{t,s}\)</span>,</p>
<p><span class="math display">\[
C_{t,s} \sim Bin(N_{t,s}; \psi_s)
\]</span></p>
<p>where <span class="math inline">\(\psi_s\)</span> is the sampling rate of carcasses in location <em>s</em>. Similar the transition rate parameters, the sampling rate parameters can be generalized to include fixed and random effects associated with intrinsic and extrinsic characteristics and random levels of variability.</p>
</section>
<section id="carcass-detection-rate" class="level3">
<h3 class="anchored" data-anchor-id="carcass-detection-rate">Carcass detection rate</h3>
<p>The carcasses detection rate is a function of the observed tagged/marked carcasses at time-step <em>t</em> in location <em>s</em>, <span class="math inline">\(M_{t,s}\)</span>, and the predicted total number of carcasses at time-step <em>t</em> in location <em>s,</em> <span class="math inline">\(\mathrm{C}_{t,s}\)</span>,</p>
<p><span class="math display">\[ M_{t,s} \sim Poisson(C_{t,s}p_s ) \]</span></p>
<p>where <span class="math inline">\(p_s\)</span> is the sampling rate of carcasses in location <em>s,</em> which may also be generalized fixed and random effects related with intrinsic and extrinsic characteristics and random levels of variability.</p>
</section>
<section id="mark-recapture-model" class="level3">
<h3 class="anchored" data-anchor-id="mark-recapture-model">Mark-recapture model</h3>
<p>The mark-recapture model considers the joint probability of the survival transition matrix <span class="math inline">\(\Phi\)</span> and the detection probability <span class="math inline">\(\mathbf{p}\)</span>.</p>
<p>The mark-recapture model can be an individual-based model, or group according to fish attributes. For the <span class="math inline">\(i^{th}\)</span> carcass, there is the tagging week <span class="math inline">\(tw_i\)</span>, the recapture week <span class="math inline">\(rw_i\)</span>, the tagging location <span class="math inline">\(tl_i\)</span> , and the recapture location <span class="math inline">\(rl_i\)</span>.</p>
<p>For caracsses that are recaptured, the joint probability of its detection history is,</p>
<p><span class="math display">\[
pr_i = \boldsymbol{\mathrm{\delta}}_{i,j} \times \biggr[ \prod_{j=(tw_i+1)}^{j=(rw_i-1)}\Phi_{\Delta t_{i,j}} \times diag(\mathrm{p}_{:,6})\biggr] \times \Phi_{\Delta t_{i,j}} \times diag(\mathrm{p}_{:,rl_i}) \times \mathrm{I}_{ns} \times \mathrm{1}
\]</span></p>
<p>where, <span class="math inline">\(\boldsymbol{\delta}_i\)</span> is a <span class="math inline">\(1\times 6\)</span> matrix with a one at column <span class="math inline">\(tl_i\)</span> and zeros elsewhere, <span class="math inline">\(\boldsymbol{\Phi}_{\Delta t_{i,j}}\)</span> is the 6X6 transition probability matrix related to the time between <span class="math inline">\(j^{th}\)</span> and <span class="math inline">\(j^{th}-1\)</span> survey for the <span class="math inline">\(i^{th}\)</span> carcass ( <span class="math inline">\(\Delta_{t_{i,j}}\)</span> ), <span class="math inline">\(diag(\mathrm{p}_{:,6})\)</span> is a matrix with the non-detection probabilities on the diagonal, <span class="math inline">\(diag(\mathrm{p}_{:,rl_i})\)</span> is a matrix with the column of the recapture location along the diagonal, and <span class="math inline">\(\mathrm{1}\)</span> is a vector of ones of length 6. The part in the square brackets is the nondetections.</p>
<p>While the matrix, <span class="math inline">\(\mathrm{I}_{ns}\)</span> , has no effect on the likelihood, it is important to understand why this model provides a complete accounting of the survey design. The first observation after the recapture of the <span class="math inline">\(i^{th}\)</span> carcass is uniquely different than the non-detection and recapture detection preceding it. First, for a <em>dead</em> carcass that is removed from the survey in any location, the detection probability of a <em>live</em> carcass is 0 and the detection probability for the <em>dead</em> carcass is.</p>
<p><span class="math display">\[
\mathrm{p} = \begin{bmatrix} 0 &amp; 0 &amp; \dots &amp; 1\\  0 &amp; 0 &amp; \dots &amp; 1 \\ \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\ 0 &amp; 0 &amp; \dots &amp; 1 \end{bmatrix}
\]</span></p>
<p>Second, as previously described in the transition probability matrix, because the transition from <em>live</em> to <em>dead</em> is instantaneous, the transition matrix is,</p>
<p><span class="math display">\[
\Phi_{\Delta t \rightarrow 0} = \mathrm{I}
\]</span></p>
<p>Therefore, the probability of the carcass transitioning to the dead state is</p>
<p><span class="math display">\[
\mathrm{I}_{ns} = \mathrm{I} \times diag(\mathrm{p}_{:,ns})
\]</span></p>
<p>The joint likelihood of the observed number of outcomes for the <span class="math inline">\(i^{th}\)</span> detection histories, given the predicted probability of that outcomes, <span class="math inline">\(pr_i\)</span> , is</p>
<p><span class="math display">\[ NLL = -\sum_i(n_i\times log(pr_i))   
\]</span></p>
</section>
<section id="random-effects" class="level3">
<h3 class="anchored" data-anchor-id="random-effects">Random effects</h3>
<section id="births-1" class="level4">
<h4 class="anchored" data-anchor-id="births-1">Births</h4>
<p>Random deivates in the total number of <em>births</em> at time step <span class="math inline">\(\varepsilon^B_t\)</span> are normally distribution</p>
<p><span class="math display">\[ \varepsilon^B_t \sim N(0,\sigma_B) \]</span></p>
<p>where, <span class="math inline">\(\sigma^B\)</span> is the standard deviation of the deviates across all time steps.</p>
</section>
<section id="detection-probability-survival-and-tagging-rate" class="level4">
<h4 class="anchored" data-anchor-id="detection-probability-survival-and-tagging-rate">Detection probability, survival, and tagging rate</h4>
<p>All of these processes can include random deviates.</p>
</section>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Reading the data from my local drive. If you have cloned the github, you should not need to change anything.</p>
<div class="cell">

</div>
<div class="cell">
<div class="cell-output-display">

<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>Summary table of the data for Lewis River carcass tag recovery analysis.</caption>
 <thead>
  <tr>
   <th style="text-align:right;"> t_k </th>
   <th style="text-align:right;"> r_k </th>
   <th style="text-align:right;"> t_l </th>
   <th style="text-align:right;"> r_l </th>
   <th style="text-align:left;"> tag </th>
   <th style="text-align:right;"> n </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:left;"> TRUE </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> TRUE </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> TRUE </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:left;"> TRUE </td>
   <td style="text-align:right;"> 2 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:left;"> TRUE </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:left;"> TRUE </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Once the data are wrangled, we can create the data and parameter list to feed into RTMB.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">t_k =</span> d<span class="sc">$</span>t_k,   <span class="co"># First detection week</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">r_k =</span> d<span class="sc">$</span>r_k,   <span class="co"># Recapture week (NA if not recaptured)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">t_l =</span> d<span class="sc">$</span>t_l,   <span class="co"># First detection location</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">r_l =</span> d<span class="sc">$</span>r_l,   <span class="co"># Recapture location (NA if not recaptured)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">tag =</span> <span class="fu">as.integer</span>(d<span class="sc">$</span>tag) <span class="co"># Whether tagged (1 = tagged, 0 = not)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>parameters <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">surv_par =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">15</span>),      <span class="co"># Logit persistence probability</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection_par =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">5</span>),        <span class="co"># Logit detection probability</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">taggingRate_par =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">5</span>),      <span class="co"># Logit tagging probability</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">taggingRate_re =</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="fu">max</span>(data<span class="sc">$</span>t_k)),      <span class="co"># Logit tagging probability</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">par_PopTotal =</span> <span class="dv">1</span>,   <span class="co"># Log expected carcass births</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_time_sig =</span> <span class="dv">0</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_loc_sig =</span> <span class="dv">0</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">taggingRate_sig =</span> <span class="dv">0</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_time =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">max</span>(data<span class="sc">$</span>t_k)),  <span class="co">#Carcasses by week</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">B_loc =</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">5</span>,<span class="fu">max</span>(data<span class="sc">$</span>t_k))  <span class="co">#Distribution of carcasses by location</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="code" class="level3">
<h3 class="anchored" data-anchor-id="code">Code</h3>
<p>Quarto doesn’t allow for RTMB to be run from an embedded code chunk - this isn’t a problem with other markdown compilers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../R/test_code_MV2.r"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="fits-to-the-data" class="level3">
<h3 class="anchored" data-anchor-id="fits-to-the-data">Fits to the data</h3>
<section id="total-carcasses-n_ts-times-p_ts" class="level4">
<h4 class="anchored" data-anchor-id="total-carcasses-n_ts-times-p_ts">Total carcasses, <span class="math inline">\(N_{t,s} \times p_{t,s}\)</span></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(sd.est<span class="sc">$</span>E_TotalCarcasses_t)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>E<span class="sc">$</span>sd <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(sd.sd<span class="sc">$</span>E_TotalCarcasses_t)<span class="sc">$</span>value</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>E<span class="sc">$</span>obs <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(rep<span class="sc">$</span>TotalCarcasses_t)<span class="sc">$</span>value</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>E <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Var1 <span class="sc">!=</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> obs)) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> value), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> value <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sd, <span class="at">ymax =</span> value <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sd), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Var2, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location"</span>) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Number of total carcasses"</span>) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="KaleDoc_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="carcass-tagging-rate-c_ts-times-psi_ts" class="level4">
<h4 class="anchored" data-anchor-id="carcass-tagging-rate-c_ts-times-psi_ts">Carcass tagging rate, <span class="math inline">\(C_{t,s} \times \psi_{t,s}\)</span></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(sd.est<span class="sc">$</span>E_TaggedCarcasses_t)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>E<span class="sc">$</span>sd <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(sd.sd<span class="sc">$</span>E_TaggedCarcasses_t)<span class="sc">$</span>value</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>E<span class="sc">$</span>obs <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(rep<span class="sc">$</span>TaggedCarcasses_t)<span class="sc">$</span>value</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>E <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Var1 <span class="sc">!=</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> obs)) <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> value), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> value <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sd, <span class="at">ymax =</span> value <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sd), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Var2, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location"</span>) <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Number of tagged carcasses"</span>) <span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="KaleDoc_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="mark-recapture-data-n_tmathrmt-times-phi-times-mathrmp" class="level4">
<h4 class="anchored" data-anchor-id="mark-recapture-data-n_tmathrmt-times-phi-times-mathrmp">Mark-recapture data <span class="math inline">\((N_{t,:})^\mathrm{T} \times \Phi \times \mathrm{p}\)</span></h4>
<p>These estimates represent the number of recaptured (y-axis) by recapture location (x-axis) based on the tagging location (rows) and tagging time-step (columns)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(t_k, t_l, tag) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">t_k_total =</span> <span class="fu">sum</span>(n))  <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">obs =</span> n)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># E$p &lt;-  rep$probability_of_outcome</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>E<span class="sc">$</span>pred <span class="ot">&lt;-</span> sd.est<span class="sc">$</span>pred2</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>E<span class="sc">$</span>sd <span class="ot">&lt;-</span> sd.sd<span class="sc">$</span>pred2</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> E <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tag <span class="sc">==</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(t_k,t_l,r_l) <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">obs =</span> <span class="fu">sum</span>(obs),</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">pred =</span> <span class="fu">sum</span>(<span class="fu">exp</span>(pred)),</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd =</span> <span class="fu">sum</span>(sd))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 't_k', 't_l'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>E <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(t_k<span class="sc">&lt;=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r_l =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(r_l),<span class="dv">6</span>,r_l)) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> r_l, <span class="at">y =</span> obs)) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> r_l, <span class="at">y =</span> (pred)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="fu">exp</span>(<span class="fu">log</span>(pred) <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sd), <span class="at">ymax =</span> <span class="fu">exp</span>(<span class="fu">log</span>(pred) <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sd)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(t_l<span class="sc">~</span>t_k, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Recapture location"</span>) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove major grid lines</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()   <span class="co"># Remove minor grid lines</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="KaleDoc_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>E <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(t_k<span class="sc">&gt;</span><span class="dv">5</span> <span class="sc">&amp;</span> t_k<span class="sc">&lt;=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r_l =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(r_l),<span class="dv">6</span>,r_l)) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> r_l, <span class="at">y =</span> obs)) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> r_l, <span class="at">y =</span> (pred)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="fu">exp</span>(<span class="fu">log</span>(pred) <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sd), <span class="at">ymax =</span> <span class="fu">exp</span>(<span class="fu">log</span>(pred) <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sd)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_grid</span>(t_l<span class="sc">~</span>t_k, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Recapture location"</span>) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove major grid lines</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()   <span class="co"># Remove minor grid lines</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="KaleDoc_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>E <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(t_k<span class="sc">&gt;</span><span class="dv">11</span> <span class="sc">&amp;</span> t_k<span class="sc">&lt;=</span><span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r_l =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(r_l),<span class="dv">6</span>,r_l)) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> r_l, <span class="at">y =</span> obs)) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> r_l, <span class="at">y =</span> (pred)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="fu">exp</span>(<span class="fu">log</span>(pred) <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sd), <span class="at">ymax =</span> <span class="fu">exp</span>(<span class="fu">log</span>(pred) <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sd)), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">facet_grid</span>(t_l<span class="sc">~</span>t_k, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Recapture location"</span>) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove major grid lines</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()   <span class="co"># Remove minor grid lines</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="KaleDoc_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="derived-variables" class="level3">
<h3 class="anchored" data-anchor-id="derived-variables">Derived variables</h3>
<section id="total-births" class="level4">
<h4 class="anchored" data-anchor-id="total-births">Total births</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(sd.est<span class="sc">$</span>B_total)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>E<span class="sc">$</span>sd <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(sd.sd<span class="sc">$</span>B_total)<span class="sc">$</span>value</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>,sd.est<span class="sc">$</span>B_total,sd.sd<span class="sc">$</span>B_total)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">exp</span>(x),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">""</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Total births"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="KaleDoc_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#E %&gt;% #filter(Var1 != 6) %&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  ggplot(aes(x = Var1, y = exp(value))) +</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_col() +</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_errorbar(aes(ymin = exp(value - 1.96 * sd), ymax = exp(value + 1.96 * sd))) +</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  xlab("Location") +</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  ylab("Total births") +</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  theme_classic()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="births-by-day-and-location" class="level4">
<h4 class="anchored" data-anchor-id="births-by-day-and-location">Births by day and location</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(sd.est<span class="sc">$</span>B_ts)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>E<span class="sc">$</span>sd <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(sd.sd<span class="sc">$</span>B_ts)<span class="sc">$</span>value</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>E <span class="sc">%&gt;%</span> <span class="co">#filter(Var1 != 6) %&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> <span class="fu">exp</span>(value))) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="fu">exp</span>(value <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sd), <span class="at">ymax =</span> <span class="fu">exp</span>(value <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sd))) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Var2, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location"</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Births"</span>) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="KaleDoc_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="total-carcasses" class="level4">
<h4 class="anchored" data-anchor-id="total-carcasses">Total carcasses</h4>
</section>
</section>
<section id="parameters" class="level3">
<h3 class="anchored" data-anchor-id="parameters">Parameters</h3>
<section id="transition-matrix-psi" class="level4">
<h4 class="anchored" data-anchor-id="transition-matrix-psi">Transition matrix <span class="math inline">\(\Psi\)</span></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>p.mat <span class="ot">&lt;-</span> corrplot<span class="sc">::</span><span class="fu">cor.mtest</span>(rep<span class="sc">$</span>surv)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> rep<span class="sc">$</span>surv</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># M[6,6] &lt;- NA</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">"NLL"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),<span class="st">"'Death'"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(M) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">"NLL"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),<span class="st">"'Death'"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  M, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"color"</span>,       <span class="co"># or "color", "ellipse", etc.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"upper"</span>,          <span class="co"># upper or lower triangle of correlation matrix</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">addCoef.col =</span> <span class="st">"black"</span>,   <span class="co"># color of correlation coefficients</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">tl.col =</span> <span class="st">"black"</span>,        <span class="co"># color of text labels (variable names)</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">tl.srt =</span> <span class="dv">45</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.lim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># text label rotation</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="KaleDoc_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="detection-matrix-mathrmp" class="level4">
<h4 class="anchored" data-anchor-id="detection-matrix-mathrmp">Detection matrix <span class="math inline">\(\mathrm{p}\)</span></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>p.mat <span class="ot">&lt;-</span> corrplot<span class="sc">::</span><span class="fu">cor.mtest</span>(rep<span class="sc">$</span>p)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> rep<span class="sc">$</span>p</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># M[6,6] &lt;- NA</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(M) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">"NLL"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),<span class="st">"'Non-detect'"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(M) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">"NLL"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),<span class="st">"'Non-detect'"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  M, </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"color"</span>,       <span class="co"># or "color", "ellipse", etc.</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"upper"</span>,          <span class="co"># upper or lower triangle of correlation matrix</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">addCoef.col =</span> <span class="st">"black"</span>,   <span class="co"># color of correlation coefficients</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">tl.col =</span> <span class="st">"black"</span>,        <span class="co"># color of text labels (variable names)</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">tl.srt =</span> <span class="dv">45</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.lim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># text label rotation</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="KaleDoc_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="tagging-rate" class="level4">
<h4 class="anchored" data-anchor-id="tagging-rate">Tagging rate</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(sd.est<span class="sc">$</span>taggingRate)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>E<span class="sc">$</span>sd <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(sd.sd<span class="sc">$</span>taggingRate)<span class="sc">$</span>value</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>E <span class="sc">%&gt;%</span> <span class="co">#filter(Var1 != 6) %&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Var2, <span class="at">y =</span> (value))) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> (value <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> sd), <span class="at">ymax =</span> (value <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> sd))) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Var1, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Location"</span>) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Tagging rate"</span>) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="KaleDoc_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>